{% extends "base.html" %}
{% block content %}

<div class="chat-page">
    <div class="chat-page-title">âœ¦ Sacred Dialogue</div>

    <div class="chat-wrapper">
        <header class="chat-header">
            <div>
                <h2>Chat with Krishna</h2>
                <p class="muted">Ask gently â€” receive calm, scripture-rooted guidance.</p>
            </div>
            <div class="chat-actions">
                <a href="/daily-shloka" class="btn btn-ghost">ðŸ“¿ Daily Shloka</a>
            </div>
        </header>

        <div class="conversations-bar">
            <div class="tabs">
                {% for conv in conversations %}
                <a class="tab {% if conv.id == selected_conv %}active{% endif %}"
                    href="{{ url_for('chat') }}?conv_id={{ conv.id }}">{{ conv.title or 'Chat' }}</a>
                {% endfor %}
            </div>
            <form method="post" action="{{ url_for('new_conversation') }}" class="new-conv-form">
                <input name="title" placeholder="New chat nameâ€¦" />
                <button class="btn btn-ghost">+ New</button>
            </form>
        </div>

        <div class="chat-window" id="chat-window">
            <div class="messages">
                {% for c in chats %}
                <div class="message user">
                    <div class="bubble">
                        <div class="meta">You</div>
                        <div class="text">{{ c.user_message }}</div>
                    </div>
                </div>
                <div class="message krishna">
                    <div class="bubble">
                        <div class="meta">ðŸ¦š Krishna</div>
                        <div class="text">{{ c.ai_response }}</div>
                    </div>
                </div>
                {% else %}
                <p class="muted" style="text-align:center;padding:40px 0;">
                    ðŸŒ¸ No conversation yet â€” start by asking a question below.
                </p>
                {% endfor %}
            </div>
        </div>

        <form method="post" class="chat-input" onsubmit="setTimeout(() => scrollChatToBottom(), 120);">
            <textarea name="message" placeholder="Ask Krishna about stress, fear, or confusionâ€¦" required></textarea>
            <button type="submit" class="btn btn-primary">Send âœ¦</button>
        </form>
    </div>
</div>

{% endblock %}