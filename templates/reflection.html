{% extends "base.html" %}
{% block content %}

<div class="reflection-page">
  <div class="page-title-block">
    <div class="page-eyebrow">âœï¸ Inner Journey</div>
    <h2>My Reflections</h2>
    <p class="page-subtitle">A personal space to record your thoughts, learnings, and inner growth.</p>
  </div>

  <form method="post" class="reflection-form">
    <textarea name="content" placeholder="Write your reflection hereâ€¦ What did you feel, learn, or discover today?"
      required></textarea>
    <div class="reflection-form-footer">
      <button type="submit" class="btn btn-primary">Save Reflection âœ¦</button>
    </div>
  </form>

  <div class="reflection-list">
    {% for r in reflections %}
    <div class="reflection-wrapper" id="reflection-{{ r.id }}">
      <div class="reflection-meta">
        <span class="reflection-badge">ğŸ¦š Reflection</span>
        <div class="reflection-actions">
          <button type="button" class="edit-btn" onclick="toggleEdit({{ r.id }})" id="edit-toggle-{{ r.id }}">âœï¸
            Edit</button>
          <form method="post" action="{{ url_for('delete_reflection', reflection_id=r.id) }}" style="display:inline;">
            <button type="submit" class="delete-btn" onclick="return confirm('Delete this reflection?');">ğŸ—‘
              Delete</button>
          </form>
        </div>
      </div>

      <div class="reflection-card" id="view-{{ r.id }}">
        <p>{{ r.content }}</p>
      </div>

      <form method="post" action="{{ url_for('edit_reflection', reflection_id=r.id) }}" class="reflection-edit-form"
        id="edit-{{ r.id }}" style="display:none;">
        <textarea name="content" class="edit-textarea" required>{{ r.content }}</textarea>
        <div class="edit-form-actions">
          <button type="submit" class="btn btn-primary">Save Changes âœ¦</button>
          <button type="button" class="btn btn-ghost" onclick="cancelEdit({{ r.id }})">Cancel</button>
        </div>
      </form>
    </div>
    {% else %}
    <p class="no-reflection">No reflections yet â€” begin your inner journey âœ¨</p>
    {% endfor %}
  </div>
</div>

<script>
  function toggleEdit(id) {
    document.getElementById('view-' + id).style.display = 'none';
    document.getElementById('edit-' + id).style.display = 'block';
    const btn = document.getElementById('edit-toggle-' + id);
    btn.textContent = 'âœ• Cancel';
    btn.onclick = () => cancelEdit(id);
    const ta = document.getElementById('edit-' + id).querySelector('textarea');
    ta.focus(); ta.setSelectionRange(ta.value.length, ta.value.length);
  }
  function cancelEdit(id) {
    document.getElementById('view-' + id).style.display = 'block';
    document.getElementById('edit-' + id).style.display = 'none';
    const btn = document.getElementById('edit-toggle-' + id);
    btn.textContent = 'âœï¸ Edit';
    btn.onclick = () => toggleEdit(id);
  }
</script>
{% endblock %}