{% extends "base.html" %}
{% block content %}

<div class="chat-page">
    <div class="chat-page-title">âœ¦ Sacred Dialogue</div>

    <div class="chat-layout">

        <!-- â”€â”€ LEFT SIDEBAR: Conversations â”€â”€ -->
        <aside class="conv-sidebar">
            <div class="conv-sidebar-header">
                <span class="conv-sidebar-label">Conversations</span>
            </div>

            <nav class="conv-list">
                {% for conv in conversations %}
                <div class="conv-item {% if conv.id == selected_conv %}active{% endif %}">
                    <a href="{{ url_for('chat') }}?conv_id={{ conv.id }}" class="conv-title">
                        ðŸ—¨ {{ conv.title }}
                    </a>
                    <form method="post" action="{{ url_for('delete_conversation', conv_id=conv.id) }}"
                        onsubmit="return confirm('Delete this conversation?');" class="conv-delete-form">
                        <button type="submit" class="conv-delete-btn" title="Delete">âœ•</button>
                    </form>
                </div>
                {% else %}
                <p class="conv-empty">No conversations yet.</p>
                {% endfor %}
            </nav>

            <form method="post" action="{{ url_for('new_conversation') }}" class="new-conv-form">
                <input name="title" placeholder="Chat nameâ€¦" />
                <button type="submit" class="btn btn-ghost new-conv-btn">+ New</button>
            </form>
        </aside>

        <!-- â”€â”€ RIGHT: Chat Area â”€â”€ -->
        <div class="chat-wrapper">
            <header class="chat-header">
                <div>
                    <h2>Chat with Krishna</h2>
                    <p class="muted">Ask gently â€” receive calm, scripture-rooted guidance.</p>
                </div>
                <div class="chat-actions">
                    <a href="/daily-shloka" class="btn btn-ghost">ðŸ“¿ Daily Shloka</a>
                </div>
            </header>

            <div class="chat-window" id="chat-window">
                <div class="messages">
                    {% for c in chats %}
                    <div class="message user">
                        <div class="bubble">
                            <div class="meta">You</div>
                            <div class="text">{{ c.user_message }}</div>
                        </div>
                    </div>
                    <div class="message krishna">
                        <div class="bubble">
                            <div class="meta">ðŸ¦š Krishna</div>
                            <div class="text">{{ c.ai_response }}</div>
                        </div>
                    </div>
                    {% else %}
                    <p class="muted" style="text-align:center;padding:40px 0;">
                        ðŸŒ¸ No messages yet â€” start by asking a question below.
                    </p>
                    {% endfor %}
                </div>
            </div>

            <form method="post" class="chat-input" onsubmit="setTimeout(() => scrollChatToBottom(), 120);">
                <textarea name="message" placeholder="Ask Krishna about stress, fear, or confusionâ€¦"
                    required></textarea>
                <button type="submit" class="btn btn-primary">Send âœ¦</button>
            </form>
        </div>

    </div>
</div>

<script>
    function scrollChatToBottom() {
        const w = document.getElementById('chat-window');
        if (w) w.scrollTop = w.scrollHeight;
    }
    scrollChatToBottom();
</script>

{% endblock %}